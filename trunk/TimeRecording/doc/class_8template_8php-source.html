<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
<title>TimeRecording: C:/xampp/htdocs/TimeRecording/class.template.php Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
<link href="tabs.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.5.6 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="index.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
<h1>C:/xampp/htdocs/TimeRecording/class.template.php</h1><a href="class_8template_8php.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 &lt;?php
<a name="l00002"></a>00002 <span class="comment">/* vim: set expandtab sw=4 ts=4 sts=4: */</span>
<a name="l00012"></a><a class="code" href="class_template.html">00012</a> <span class="keyword">class </span><a class="code" href="class_template.html">Template</a>
<a name="l00013"></a>00013         {
<a name="l00014"></a><a class="code" href="class_template.html#0aa730ee4f211368b447c6e3a52c935c">00014</a>                 <span class="keyword">private</span> <a class="code" href="class_template.html#0aa730ee4f211368b447c6e3a52c935c">$template</a>     = array();
<a name="l00015"></a><a class="code" href="class_template.html#d330a17c8ff788dcba48bd00e1d64eb2">00015</a>                 <span class="keyword">private</span> <a class="code" href="class_template.html#d330a17c8ff788dcba48bd00e1d64eb2">$assigned</a>     = array();
<a name="l00016"></a><a class="code" href="class_template.html#f6525f2432c8c870c5c25091098aba7c">00016</a>                 <span class="keyword">private</span> <a class="code" href="class_template.html#f6525f2432c8c870c5c25091098aba7c">$debug_off</a>    = <span class="keyword">true</span>;
<a name="l00017"></a><a class="code" href="class_template.html#8f80b6b931c01e6795bed770fb0605d6">00017</a>                 <span class="keyword">private</span> <a class="code" href="class_template.html#8f80b6b931c01e6795bed770fb0605d6">$do_compress</a>  = <span class="keyword">true</span>;
<a name="l00018"></a><a class="code" href="class_template.html#ef233f4654c3c598680b132012fa6800">00018</a>                 <span class="keyword">private</span> <a class="code" href="class_template.html#ef233f4654c3c598680b132012fa6800">$sql_table</a>    = <span class="keyword">false</span>;
<a name="l00019"></a><a class="code" href="class_template.html#848a4caabd12c5c9bb39a5a4496693e8">00019</a>                 <span class="keyword">private</span> <a class="code" href="class_template.html#848a4caabd12c5c9bb39a5a4496693e8">$sql_type</a>     = <span class="keyword">false</span>;
<a name="l00020"></a><a class="code" href="class_template.html#7824aefa3d521797b04ec59ea5166861">00020</a>                 <span class="keyword">private</span> <a class="code" href="class_template.html#7824aefa3d521797b04ec59ea5166861">$debugout</a>     = <span class="stringliteral">""</span>;
<a name="l00021"></a><a class="code" href="class_template.html#70c2f52d8d0837df5d73da6969b964c3">00021</a>                 <span class="keyword">private</span> <a class="code" href="class_template.html#70c2f52d8d0837df5d73da6969b964c3">$menu_content</a> = <span class="stringliteral">""</span>;
<a name="l00022"></a><a class="code" href="class_template.html#a5a9b9e6807c0377a4ac37a1f4e1eb20">00022</a>                 <span class="keyword">private</span> <a class="code" href="class_template.html#a5a9b9e6807c0377a4ac37a1f4e1eb20">$menu_spacer</a>  = <span class="keyword">false</span>;
<a name="l00023"></a><a class="code" href="class_template.html#c99b87e6e1e3d0106f24bcd6681c906e">00023</a>                 <span class="keyword">private</span> <a class="code" href="class_template.html#c99b87e6e1e3d0106f24bcd6681c906e">$tpl_folder</a>   = <span class="stringliteral">"./templates/"</span>;
<a name="l00024"></a>00024                 
<a name="l00034"></a><a class="code" href="class_template.html#814922d791d909c27f6dc7db93829964">00034</a>                 <span class="keyword">public</span> function <a class="code" href="class_template.html#814922d791d909c27f6dc7db93829964">__construct</a>($parameters = array())
<a name="l00035"></a>00035                 {
<a name="l00036"></a>00036                         $this-&gt;tpl_folder  = (isset($parameters[0])) ? $parameters[0] : <span class="stringliteral">"./templates/"</span>;
<a name="l00037"></a>00037                         $this-&gt;debug_off   = (isset($parameters[1])) ? $parameters[1] : <span class="keyword">true</span>;
<a name="l00038"></a>00038                         $this-&gt;do_compress = (isset($parameters[2])) ? $parameters[2] : <span class="keyword">true</span>;
<a name="l00039"></a>00039                         $this-&gt;menu_spacer = <span class="keyword">false</span>;
<a name="l00040"></a>00040                 }
<a name="l00041"></a>00041                 
<a name="l00049"></a><a class="code" href="class_template.html#a2f358a1c51806e08d35cc1b674b2f6a">00049</a>                 <span class="keyword">public</span> function <a class="code" href="class_template.html#a2f358a1c51806e08d35cc1b674b2f6a">__destruct</a>()
<a name="l00050"></a>00050                 {
<a name="l00051"></a>00051                 }
<a name="l00052"></a>00052                 
<a name="l00060"></a><a class="code" href="class_template.html#3bb2eb4b98aebbfa4310523c4a3688ad">00060</a>                 <span class="keyword">public</span> function <a class="code" href="class_template.html#3bb2eb4b98aebbfa4310523c4a3688ad">clean_ob</a>()
<a name="l00061"></a>00061                 {
<a name="l00062"></a>00062                         <span class="keywordflow">if</span> (!ob_get_length() || !ob_get_level())
<a name="l00063"></a>00063                                 {
<a name="l00064"></a>00064                                         session_cache_limiter(<span class="stringliteral">'must-revalidate'</span>);
<a name="l00065"></a>00065                                         ob_start();
<a name="l00066"></a>00066                                         ob_clean();
<a name="l00067"></a>00067                                 }
<a name="l00068"></a>00068                 }
<a name="l00069"></a>00069                 
<a name="l00079"></a><a class="code" href="class_template.html#f5ef4a35c20925139500208d32cb61d9">00079</a>                 <span class="keyword">public</span> function <a class="code" href="class_template.html#f5ef4a35c20925139500208d32cb61d9">preload</a>($list = <span class="keyword">false</span>)
<a name="l00080"></a>00080                 {
<a name="l00081"></a>00081                         <span class="comment">// build specific sql query statements</span>
<a name="l00082"></a>00082                         <span class="keywordflow">if</span> (is_array($list))
<a name="l00083"></a>00083                                 {
<a name="l00084"></a>00084                                         $list = implode(<span class="stringliteral">"','"</span>, $list);
<a name="l00085"></a>00085                                         $list = <span class="stringliteral">" WHERE file IN ( '$list' )"</span>;
<a name="l00086"></a>00086                                 }
<a name="l00087"></a>00087                         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (is_string($list))
<a name="l00088"></a>00088                                 {
<a name="l00089"></a>00089                                         $list = str_replace(<span class="stringliteral">","</span>, <span class="stringliteral">"','"</span>, $list);
<a name="l00090"></a>00090                                         $list = <span class="stringliteral">" WHERE file IN ( '$list' )"</span>;
<a name="l00091"></a>00091                                 }
<a name="l00092"></a>00092                                 
<a name="l00093"></a>00093                         <span class="comment">// get templates table in database</span>
<a name="l00094"></a>00094                         $table  = $_SESSION[<span class="stringliteral">"_TplSqlTable"</span>];
<a name="l00095"></a>00095                         
<a name="l00096"></a>00096                         $query  = <span class="stringliteral">"SELECT file, content FROM $table $list;"</span>;
<a name="l00097"></a>00097                         $result = $_SESSION[$_SESSION[<span class="stringliteral">"_SqlType"</span>]]-&gt;query($query);
<a name="l00098"></a>00098                         
<a name="l00099"></a>00099                         <span class="comment">// prebuffer every found template</span>
<a name="l00100"></a>00100                         <span class="keywordflow">while</span> ($row = $_SESSION[$_SESSION[<span class="stringliteral">"_SqlType"</span>]]-&gt;fetch_array())
<a name="l00101"></a>00101                                 {
<a name="l00102"></a>00102                                         $this-&gt;<span class="keyword">template</span>[ $row[<span class="stringliteral">'file'</span>] ] = $row[<span class="stringliteral">'content'</span>];
<a name="l00103"></a>00103                                         $this-&gt;assigned[ $row[<span class="stringliteral">'file'</span>] ] = array();
<a name="l00104"></a>00104                                 }
<a name="l00105"></a>00105                 }
<a name="l00106"></a>00106                 
<a name="l00118"></a><a class="code" href="class_template.html#4d4af064d58dd2aafa5459a228bdb584">00118</a>                 <span class="keyword">public</span> function <span class="keyword">import</span>($list = <span class="keyword">false</span>)
<a name="l00119"></a>00119                 {
<a name="l00120"></a>00120                         <span class="comment">//Templates aus der Liste in die Datenbank importieren</span>
<a name="l00121"></a>00121                         $values = <span class="stringliteral">""</span>;
<a name="l00122"></a>00122                         $files  = array();
<a name="l00123"></a>00123                         
<a name="l00124"></a>00124                         <span class="keywordflow">if</span> (! $list)
<a name="l00125"></a>00125                                 {
<a name="l00126"></a>00126                                         $dir = dir($this-&gt;tpl_folder);
<a name="l00127"></a>00127                                         <span class="keywordflow">while</span> ($file = $dir-&gt;read())
<a name="l00128"></a>00128                                                 {
<a name="l00129"></a>00129                                                         <span class="keywordflow">if</span> (strlen($file) &gt; 2 &amp;&amp; ! is_dir($file) &amp;&amp; $file {0} != <span class="stringliteral">"."</span>)
<a name="l00130"></a>00130                                                                 {
<a name="l00131"></a>00131                                                                         $files[] = $file;
<a name="l00132"></a>00132                                                                 }
<a name="l00133"></a>00133                                                 }
<a name="l00134"></a>00134                                         $dir-&gt;close();
<a name="l00135"></a>00135                                 }
<a name="l00136"></a>00136                         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (is_string($list))
<a name="l00137"></a>00137                                 {
<a name="l00138"></a>00138                                         $files = explode(<span class="charliteral">','</span>, $list);
<a name="l00139"></a>00139                                 }
<a name="l00140"></a>00140                         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (is_array($list))
<a name="l00141"></a>00141                                 {
<a name="l00142"></a>00142                                         $files = $list;
<a name="l00143"></a>00143                                 }
<a name="l00144"></a>00144                         <span class="keywordflow">else</span>
<a name="l00145"></a>00145                                 {
<a name="l00146"></a>00146                                         <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00147"></a>00147                                 }
<a name="l00148"></a>00148                                 
<a name="l00149"></a>00149                         <span class="comment">// prepare query statement for all found files</span>
<a name="l00150"></a>00150                         <span class="keywordflow">foreach</span>($files as $file)
<a name="l00151"></a>00151                         {
<a name="l00152"></a>00152                                 $file     = trim($file);
<a name="l00153"></a>00153                                 $filename = $this-&gt;tpl_folder.$file;
<a name="l00154"></a>00154                                 $content  = file_get_contents($filename);
<a name="l00155"></a>00155                                 $content  = addslashes($content);
<a name="l00156"></a>00156                                 $values  .= (($values == <span class="stringliteral">""</span>) ? <span class="stringliteral">""</span> : <span class="stringliteral">", "</span>) . <span class="stringliteral">"( '$file', '$content' )"</span>;
<a name="l00157"></a>00157                         }
<a name="l00158"></a>00158                         
<a name="l00159"></a>00159                         <span class="comment">// try to renew complete table of templates</span>
<a name="l00160"></a>00160                         <span class="keywordflow">try</span>
<a name="l00161"></a>00161                                 {
<a name="l00162"></a>00162                                         $table = $_SESSION[<span class="stringliteral">"_TplSqlTable"</span>];
<a name="l00163"></a>00163                                         $_SESSION[$_SESSION[<span class="stringliteral">"_SqlType"</span>]]-&gt;query(<span class="stringliteral">"TRUNCATE TABLE $table;"</span>);
<a name="l00164"></a>00164                                         $_SESSION[$_SESSION[<span class="stringliteral">"_SqlType"</span>]]-&gt;query(<span class="stringliteral">"INSERT INTO $table ( file , content ) VALUES $values;"</span>);
<a name="l00165"></a>00165                                         <span class="keywordflow">return</span> $_SESSION[$_SESSION[<span class="stringliteral">"_SqlType"</span>]]-&gt;affected_rows();
<a name="l00166"></a>00166                                 }
<a name="l00167"></a>00167                         <span class="keywordflow">catch</span> (Exception $e)
<a name="l00168"></a>00168                                 {
<a name="l00169"></a>00169                                         die($e-&gt;getMessage());
<a name="l00170"></a>00170                                 }
<a name="l00171"></a>00171                 }
<a name="l00172"></a>00172                 
<a name="l00183"></a><a class="code" href="class_template.html#8580cc17a248c0fa9434639cbe37bd1b">00183</a>                 <span class="keyword">public</span> function <a class="code" href="class_template.html#8580cc17a248c0fa9434639cbe37bd1b">load</a>($name, $force_reload = <span class="keyword">false</span>)
<a name="l00184"></a>00184                 {
<a name="l00185"></a>00185                         <span class="comment">// use post and get session id, if no cookies</span>
<a name="l00186"></a>00186                         <span class="keywordflow">if</span> (ini_get(<span class="stringliteral">"session.use_cookies"</span>) != <span class="stringliteral">"1"</span>)
<a name="l00187"></a>00187                                 {
<a name="l00188"></a>00188                                         $this-&gt;<a class="code" href="class_template.html#58e32e7c796ae46e37f4e3a1392eb21e">assign</a>($name, <span class="stringliteral">"{{SID}}"</span>, session_id());
<a name="l00189"></a>00189                                 }
<a name="l00190"></a>00190                         <span class="keywordflow">else</span>
<a name="l00191"></a>00191                                 {
<a name="l00192"></a>00192                                         $this-&gt;<a class="code" href="class_template.html#58e32e7c796ae46e37f4e3a1392eb21e">assign</a>($name, <span class="stringliteral">"{{SID}}"</span>, <span class="stringliteral">""</span>);
<a name="l00193"></a>00193                                 }
<a name="l00194"></a>00194                                 
<a name="l00195"></a>00195                         <span class="comment">// default assignments for system use in forms and links</span>
<a name="l00196"></a>00196                         $this-&gt;<a class="code" href="class_template.html#58e32e7c796ae46e37f4e3a1392eb21e">assign</a>($name, <span class="stringliteral">"{{PAGE}}"</span>,   $_SESSION[<span class="stringliteral">"_PageID.current"</span>]);
<a name="l00197"></a>00197                         $this-&gt;<a class="code" href="class_template.html#58e32e7c796ae46e37f4e3a1392eb21e">assign</a>($name, <span class="stringliteral">"{{ACTION}}"</span>, $_SESSION[<span class="stringliteral">"_Action"</span>]);
<a name="l00198"></a>00198                         
<a name="l00199"></a>00199                         <span class="comment">// if template loaded, don't waste time and return</span>
<a name="l00200"></a>00200                         <span class="keywordflow">if</span> (isset($this-&gt;<span class="keyword">template</span>[$name]) &amp;&amp; ! $force_reload) <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l00201"></a>00201                         
<a name="l00202"></a>00202                         <span class="comment">// try loading from database, is options set</span>
<a name="l00203"></a>00203                         <span class="keywordflow">if</span> ($_SESSION[<span class="stringliteral">"_TplSqlTable"</span>] &amp;&amp; $_SESSION[<span class="stringliteral">"_SqlType"</span>])
<a name="l00204"></a>00204                                 {
<a name="l00205"></a>00205                                         <span class="keywordflow">try</span>
<a name="l00206"></a>00206                                                 {
<a name="l00207"></a>00207                                                         $table = $_SESSION[<span class="stringliteral">"_TplSqlTable"</span>];
<a name="l00208"></a>00208                                                         $query = <span class="stringliteral">"SELECT content FROM ${table} WHERE file = '${name}';"</span>;
<a name="l00209"></a>00209                                                         $array = $_SESSION[$_SESSION[<span class="stringliteral">"_SqlType"</span>]]-&gt;query_first($query);
<a name="l00210"></a>00210                                                         $this-&gt;<span class="keyword">template</span>[$name] = $array[<span class="stringliteral">"content"</span>];
<a name="l00211"></a>00211                                                         <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l00212"></a>00212                                                 }
<a name="l00213"></a>00213                                         <span class="keywordflow">catch</span> (Exception $e)
<a name="l00214"></a>00214                                                 {
<a name="l00215"></a>00215                                                         echo $e-&gt;getMessage();
<a name="l00216"></a>00216                                                 }
<a name="l00217"></a>00217                                 }
<a name="l00218"></a>00218                                 
<a name="l00219"></a>00219                         <span class="comment">// load template or die</span>
<a name="l00220"></a>00220                         $filename = $this-&gt;tpl_folder.$name;
<a name="l00221"></a>00221                         <span class="keywordflow">if</span> (! file_exists($filename) || is_dir($filename))
<a name="l00222"></a>00222                                 {
<a name="l00223"></a>00223                                         <span class="keywordflow">throw</span> <span class="keyword">new</span> Exception(<span class="stringliteral">"could not load template '$name' from '$filename'!"</span>);
<a name="l00224"></a>00224                                 }
<a name="l00225"></a>00225                                 
<a name="l00226"></a>00226                         $this-&gt;<span class="keyword">template</span>[$name] = file_get_contents($filename);
<a name="l00227"></a>00227                         
<a name="l00228"></a>00228                         <span class="comment">// prepare array for assigned substitutions</span>
<a name="l00229"></a>00229                         <span class="keywordflow">if</span> (! array_key_exists($name, $this-&gt;assigned))
<a name="l00230"></a>00230                                 {
<a name="l00231"></a>00231                                         array_push($this-&gt;assigned, array($name =&gt; array()));
<a name="l00232"></a>00232                                 }
<a name="l00233"></a>00233                 }
<a name="l00234"></a>00234                 
<a name="l00247"></a><a class="code" href="class_template.html#58e32e7c796ae46e37f4e3a1392eb21e">00247</a>                 <span class="keyword">public</span> function <a class="code" href="class_template.html#58e32e7c796ae46e37f4e3a1392eb21e">assign</a>($name, $search, $replace = <span class="stringliteral">"EMPTY"</span>)
<a name="l00248"></a>00248                 {
<a name="l00249"></a>00249                         <span class="keywordflow">if</span> (is_array($search))
<a name="l00250"></a>00250                                 {
<a name="l00251"></a>00251                                         <span class="keywordflow">foreach</span>($search as $key =&gt; $value) $this-&gt;assigned[$name][$key] = $value;
<a name="l00252"></a>00252                                 }
<a name="l00253"></a>00253                         <span class="keywordflow">else</span>
<a name="l00254"></a>00254                                 {
<a name="l00255"></a>00255                                         $this-&gt;assigned[$name][$search] = $replace;
<a name="l00256"></a>00256                                 }
<a name="l00257"></a>00257                 }
<a name="l00258"></a>00258                 
<a name="l00269"></a><a class="code" href="class_template.html#331ba6a6f635deea63d176dd80eb5ea3">00269</a>                 <span class="keyword">public</span> function <span class="keyword">get</span>($name, $force_reload = <span class="keyword">false</span>)
<a name="l00270"></a>00270                 {
<a name="l00271"></a>00271                         <span class="keywordflow">if</span> (! isset($this-&gt;<span class="keyword">template</span>[$name]) || $force_reload)
<a name="l00272"></a>00272                                 {
<a name="l00273"></a>00273                                         $this-&gt;<a class="code" href="class_template.html#8580cc17a248c0fa9434639cbe37bd1b">load</a>($name, $force_reload);
<a name="l00274"></a>00274                                 }
<a name="l00275"></a>00275                         $buffer = $this-&gt;<a class="code" href="class_template.html#9b300c1052c8e330d38e887ada506607">get_parsed</a>($name);
<a name="l00276"></a>00276                         $this-&gt;<a class="code" href="class_template.html#339c7c8616136872dc7aa1571339d418">special_chars</a>($buffer);
<a name="l00277"></a>00277                         <span class="keywordflow">return</span> $buffer;
<a name="l00278"></a>00278                 }
<a name="l00279"></a>00279                 
<a name="l00289"></a><a class="code" href="class_template.html#ed3ab49b2510abdcd71beac21fd1e45e">00289</a>                 <span class="keyword">public</span> function <a class="code" href="class_template.html#ed3ab49b2510abdcd71beac21fd1e45e">compress</a>(&amp;$buffer)
<a name="l00290"></a>00290                 {
<a name="l00291"></a>00291                         $length = strlen($buffer);
<a name="l00292"></a>00292                         $s = array(<span class="stringliteral">"\t"</span> =&gt; <span class="stringliteral">""</span>, <span class="stringliteral">"\n"</span> =&gt; <span class="stringliteral">" "</span>, <span class="stringliteral">"\r"</span> =&gt; <span class="stringliteral">" "</span>, <span class="stringliteral">"   "</span> =&gt; <span class="stringliteral">" "</span>, <span class="stringliteral">"  "</span> =&gt; <span class="stringliteral">" "</span>, <span class="stringliteral">"&gt; &lt;"</span> =&gt; <span class="stringliteral">"&gt;&lt;"</span>);
<a name="l00293"></a>00293                         <span class="keywordflow">do</span>
<a name="l00294"></a>00294                                 {
<a name="l00295"></a>00295                                         $len1 = strlen($buffer);
<a name="l00296"></a>00296                                         $buffer = str_replace(array_keys($s), array_values($s), $buffer);
<a name="l00297"></a>00297                                 }
<a name="l00298"></a>00298                         <span class="keywordflow">while</span> ($len1 &gt; strlen($buffer));
<a name="l00299"></a>00299                         $this-&gt;<a class="code" href="class_template.html#045a6de5bbab0abfdb67fe4d2a79cd94">restore_newlines</a>($buffer);
<a name="l00300"></a>00300                 }
<a name="l00301"></a>00301                 
<a name="l00313"></a><a class="code" href="class_template.html#31770a953650ee75daa6e8383a06d130">00313</a>                 <span class="keyword">public</span> function <a class="code" href="class_template.html#31770a953650ee75daa6e8383a06d130">output</a>($name, $type = <span class="stringliteral">"html"</span>)
<a name="l00314"></a>00314                 {
<a name="l00315"></a>00315                         <span class="comment">// if template not buffered, try to load it</span>
<a name="l00316"></a>00316                         <span class="keywordflow">if</span> (! isset($this-&gt;<span class="keyword">template</span>[$name]))
<a name="l00317"></a>00317                                 {
<a name="l00318"></a>00318                                         $this-&gt;<a class="code" href="class_template.html#8580cc17a248c0fa9434639cbe37bd1b">load</a>($name);
<a name="l00319"></a>00319                                 }
<a name="l00320"></a>00320                                 
<a name="l00321"></a>00321                         <span class="comment">// if template not buffered again, trow exception</span>
<a name="l00322"></a>00322                         <span class="keywordflow">if</span> (! isset($this-&gt;<span class="keyword">template</span>[$name]))
<a name="l00323"></a>00323                                 {
<a name="l00324"></a>00324                                         die(<span class="stringliteral">"template '$name' not found!"</span>);
<a name="l00325"></a>00325                                 }
<a name="l00326"></a>00326                                 
<a name="l00327"></a>00327                         $menu   = $this-&gt;<a class="code" href="class_template.html#0d22097e1bf560ef7d4aba58c7b1e7fe">menu_get</a>();
<a name="l00328"></a>00328                         
<a name="l00329"></a>00329                         <span class="comment">// output each timer, if present</span>
<a name="l00330"></a>00330                         <span class="keywordflow">if</span> (isset($_SESSION[<span class="stringliteral">"TIMER.MYSQL"</span>]))
<a name="l00331"></a>00331                                 {
<a name="l00332"></a>00332                                         $this-&gt;<a class="code" href="class_template.html#58e32e7c796ae46e37f4e3a1392eb21e">assign</a>($name, <span class="stringliteral">"&lt;!--TIMERS_MYSQL--&gt;"</span>, $_SESSION[<span class="stringliteral">"TIMER.MYSQL"</span>].<span class="stringliteral">"\n"</span>);
<a name="l00333"></a>00333                                         echo $_SESSION[<span class="stringliteral">"TIMER.MYSQL"</span>].<span class="stringliteral">"\n"</span>;
<a name="l00334"></a>00334                                 }
<a name="l00335"></a>00335                         <span class="keywordflow">if</span> (isset($_SESSION[<span class="stringliteral">"TIMER.MSSQL"</span>]))
<a name="l00336"></a>00336                                 {
<a name="l00337"></a>00337                                         $this-&gt;<a class="code" href="class_template.html#58e32e7c796ae46e37f4e3a1392eb21e">assign</a>($name, <span class="stringliteral">"&lt;!--TIMERS_MSSQL--&gt;"</span>, $_SESSION[<span class="stringliteral">"TIMER.MSSQL"</span>].<span class="stringliteral">"\n"</span>);
<a name="l00338"></a>00338                                         echo $_SESSION[<span class="stringliteral">"TIMER.MSSQL"</span>].<span class="stringliteral">"\n"</span>;
<a name="l00339"></a>00339                                 }
<a name="l00340"></a>00340                         <span class="keywordflow">if</span> (isset($_SESSION[<span class="stringliteral">"TIMER.PHP"</span>]))
<a name="l00341"></a>00341                                 {
<a name="l00342"></a>00342                                         $this-&gt;<a class="code" href="class_template.html#58e32e7c796ae46e37f4e3a1392eb21e">assign</a>($name, <span class="stringliteral">"&lt;!--TIMERS_PHP--&gt;"</span>, $_SESSION[<span class="stringliteral">"TIMER.PHP"</span>].<span class="stringliteral">"\n"</span>);
<a name="l00343"></a>00343                                         echo $_SESSION[<span class="stringliteral">"TIMER.PHP"</span>].<span class="stringliteral">"\n"</span>;
<a name="l00344"></a>00344                                 }
<a name="l00345"></a>00345                                 
<a name="l00346"></a>00346                         <span class="comment">// assign visible components</span>
<a name="l00347"></a>00347                         $this-&gt;<a class="code" href="class_template.html#58e32e7c796ae46e37f4e3a1392eb21e">assign</a>($name, <span class="stringliteral">"&lt;!--MENU--&gt;"</span>,   $menu);
<a name="l00348"></a>00348                         $this-&gt;<a class="code" href="class_template.html#58e32e7c796ae46e37f4e3a1392eb21e">assign</a>($name, <span class="stringliteral">"&lt;!--ERRORS--&gt;"</span>, $_SESSION[<span class="stringliteral">"_Errors"</span>]);
<a name="l00349"></a>00349                         
<a name="l00350"></a>00350                         <span class="comment">// parse and replace assignments</span>
<a name="l00351"></a>00351                         $buffer = $this-&gt;<a class="code" href="class_template.html#9b300c1052c8e330d38e887ada506607">get_parsed</a>($name);
<a name="l00352"></a>00352                         
<a name="l00353"></a>00353                         <span class="comment">// fix special html-characters</span>
<a name="l00354"></a>00354                         $this-&gt;<a class="code" href="class_template.html#339c7c8616136872dc7aa1571339d418">special_chars</a>($buffer);
<a name="l00355"></a>00355                         
<a name="l00356"></a>00356                         <span class="comment">// compress html source, if set</span>
<a name="l00357"></a>00357                         <span class="keywordflow">if</span> ($this-&gt;do_compress)
<a name="l00358"></a>00358                                 {
<a name="l00359"></a>00359                                         $this-&gt;<a class="code" href="class_template.html#ed3ab49b2510abdcd71beac21fd1e45e">compress</a>($buffer);
<a name="l00360"></a>00360                                 }
<a name="l00361"></a>00361                                 
<a name="l00362"></a>00362                         <span class="comment">// print performance infos hidden</span>
<a name="l00363"></a>00363                         echo $_SESSION[<span class="stringliteral">"MEMORY"</span>];
<a name="l00364"></a>00364                         
<a name="l00365"></a>00365                         <span class="comment">// save all previously sent output (with byte-order-mark-filter)</span>
<a name="l00366"></a>00366                         $obget = trim(ob_get_clean());
<a name="l00367"></a>00367                         $obget = str_replace(<span class="stringliteral">"\xef\xbb\xbf"</span>, <span class="stringliteral">""</span>, $obget);   <span class="comment">//BOM</span>
<a name="l00368"></a>00368                         $obget = strip_tags(utf8_encode($obget));
<a name="l00369"></a>00369                         
<a name="l00370"></a>00370                         <span class="comment">// if errormessages printed, append hidden or visible</span>
<a name="l00371"></a>00371                         <span class="keywordflow">if</span> (! empty($obget))
<a name="l00372"></a>00372                                 {
<a name="l00373"></a>00373                                         <span class="keywordflow">if</span> ($this-&gt;debug_off)
<a name="l00374"></a>00374                                                 {
<a name="l00375"></a>00375                                                         $buffer .= <span class="stringliteral">"\n&lt;!--\n"</span>.$obget.<span class="stringliteral">"\n--&gt;"</span>;
<a name="l00376"></a>00376                                                 }
<a name="l00377"></a>00377                                         <span class="keywordflow">else</span>
<a name="l00378"></a>00378                                                 {
<a name="l00379"></a>00379                                                         $buffer .= $obget;
<a name="l00380"></a>00380                                                 }
<a name="l00381"></a>00381                                 }
<a name="l00382"></a>00382                                 
<a name="l00383"></a>00383                         <span class="comment">// if gzip accepted, compress level 9</span>
<a name="l00384"></a>00384                         <span class="keywordflow">if</span> ($this-&gt;<a class="code" href="class_template.html#ba6bb377466a0592aaedebe6a3518594">accepts_gzip</a>())
<a name="l00385"></a>00385                                 {
<a name="l00386"></a>00386                                         $buffer = gzencode($buffer, 9);
<a name="l00387"></a>00387                                 }
<a name="l00388"></a>00388                                 
<a name="l00389"></a>00389                         <span class="comment">// send headers to browser and print page</span>
<a name="l00390"></a>00390                         $this-&gt;<a class="code" href="class_template.html#3f0ce81c841de02d5b5c2501f9d1e56e">headers</a>($type);
<a name="l00391"></a>00391                         header(<span class="stringliteral">"Content-Length: "</span>.strlen($buffer));
<a name="l00392"></a>00392                         echo $buffer;
<a name="l00393"></a>00393                 }
<a name="l00394"></a>00394                 
<a name="l00406"></a><a class="code" href="class_template.html#9b300c1052c8e330d38e887ada506607">00406</a>                 <span class="keyword">public</span> function <a class="code" href="class_template.html#9b300c1052c8e330d38e887ada506607">get_parsed</a>($name)
<a name="l00407"></a>00407                 {
<a name="l00408"></a>00408                         <span class="keywordflow">if</span> (array_key_exists($name, $this-&gt;assigned))
<a name="l00409"></a>00409                                 {
<a name="l00410"></a>00410                                         <span class="keywordflow">return</span> str_replace(array_keys($this-&gt;assigned[$name]), array_values($this-&gt;assigned[$name]), $this-&gt;<span class="keyword">template</span>[$name]);
<a name="l00411"></a>00411                                 }
<a name="l00412"></a>00412                         <span class="keywordflow">return</span> $this-&gt;<span class="keyword">template</span>[$name];
<a name="l00413"></a>00413                 }
<a name="l00414"></a>00414                 
<a name="l00424"></a><a class="code" href="class_template.html#3f0ce81c841de02d5b5c2501f9d1e56e">00424</a>                 <span class="keyword">public</span> function <a class="code" href="class_template.html#3f0ce81c841de02d5b5c2501f9d1e56e">headers</a>($type = <span class="stringliteral">"html"</span>,$maxage=0)
<a name="l00425"></a>00425                 {
<a name="l00426"></a>00426                         <span class="comment">// send all headers to the browser</span>
<a name="l00427"></a>00427                         header(<span class="stringliteral">'Content-Language: de'</span>);
<a name="l00428"></a>00428                         header(<span class="stringliteral">'Content-Type: text/'</span> . $type . <span class="stringliteral">'; charset=UTF-8;'</span>);
<a name="l00429"></a>00429                         header(<span class="stringliteral">'Last-Modified: '</span> . gmdate(<span class="stringliteral">'D, d M Y H:i:s'</span>) . <span class="stringliteral">' GMT'</span>);
<a name="l00430"></a>00430                         header(<span class="stringliteral">'Content-Transfer-Encoding: UTF-8'</span>);
<a name="l00431"></a>00431                         header(<span class="stringliteral">'Date: '</span> . gmdate(<span class="stringliteral">'D, d M Y H:i:s'</span>) . <span class="stringliteral">' GMT'</span>);
<a name="l00432"></a>00432                         header(<span class="stringliteral">'Accept-Ranges: bytes'</span>);
<a name="l00433"></a>00433                         header(<span class="stringliteral">'Expires: '</span> . gmdate(<span class="stringliteral">'D, d M Y H:i:s'</span>, (time()+$maxage)) . <span class="stringliteral">' GMT'</span>);
<a name="l00434"></a>00434                         header(<span class="stringliteral">'Cache-Control: max-age='</span>.$maxage);
<a name="l00435"></a>00435                         header(<span class="stringliteral">'Pragma: no-cache'</span>);
<a name="l00436"></a>00436                         <span class="keywordflow">if</span> ($this-&gt;<a class="code" href="class_template.html#ba6bb377466a0592aaedebe6a3518594">accepts_gzip</a>())
<a name="l00437"></a>00437                                 {
<a name="l00438"></a>00438                                         header(<span class="stringliteral">'X-Compression: gzip'</span>);
<a name="l00439"></a>00439                                         header(<span class="stringliteral">'Content-Encoding: gzip'</span>);
<a name="l00440"></a>00440                                         header(<span class="stringliteral">'Vary: Accept-Encoding'</span>);
<a name="l00441"></a>00441                                 }
<a name="l00442"></a>00442                         <span class="keywordflow">else</span>
<a name="l00443"></a>00443                                 {
<a name="l00444"></a>00444                                         header(<span class="stringliteral">'X-Compression: None'</span>);
<a name="l00445"></a>00445                                 }
<a name="l00446"></a>00446                 }
<a name="l00447"></a>00447                 
<a name="l00458"></a><a class="code" href="class_template.html#7a805c7ecbaa03eec906d433af09e804">00458</a>                 <span class="keyword">public</span> function <a class="code" href="class_template.html#7a805c7ecbaa03eec906d433af09e804">wraplongwords</a>(&amp;$text, $maxlen = 64)
<a name="l00459"></a>00459                 {
<a name="l00460"></a>00460                         $mytext  = explode(<span class="stringliteral">" "</span>, trim($text));
<a name="l00461"></a>00461                         $newtext = array();
<a name="l00462"></a>00462                         <span class="keywordflow">foreach</span>($mytext as $k =&gt; $txt)
<a name="l00463"></a>00463                         {
<a name="l00464"></a>00464                                 <span class="keywordflow">if</span> (strlen($txt) &gt; $maxlen)
<a name="l00465"></a>00465                                         {
<a name="l00466"></a>00466                                                 $txt = wordwrap($txt, $maxlen, <span class="stringliteral">"- "</span>, <span class="keyword">true</span>);
<a name="l00467"></a>00467                                         }
<a name="l00468"></a>00468                                 $newtext[] = $txt;
<a name="l00469"></a>00469                         }
<a name="l00470"></a>00470                         $text = implode(<span class="stringliteral">" "</span>, $newtext);
<a name="l00471"></a>00471                 }
<a name="l00472"></a>00472                 
<a name="l00483"></a><a class="code" href="class_template.html#09e1b9993524b6b6d38e4472a828d474">00483</a>                 <span class="keyword">public</span> function <a class="code" href="class_template.html#09e1b9993524b6b6d38e4472a828d474">save_newlines</a>(&amp;$text)
<a name="l00484"></a>00484                 {
<a name="l00485"></a>00485                         $text = str_replace(<span class="stringliteral">"\n"</span>, chr(31), $text);
<a name="l00486"></a>00486                 }
<a name="l00487"></a>00487                 
<a name="l00497"></a><a class="code" href="class_template.html#045a6de5bbab0abfdb67fe4d2a79cd94">00497</a>                 <span class="keyword">public</span> function <a class="code" href="class_template.html#045a6de5bbab0abfdb67fe4d2a79cd94">restore_newlines</a>(&amp;$text)
<a name="l00498"></a>00498                 {
<a name="l00499"></a>00499                         $text = str_replace(chr(31), <span class="stringliteral">"\n"</span>, $text);
<a name="l00500"></a>00500                 }
<a name="l00501"></a>00501                 
<a name="l00511"></a><a class="code" href="class_template.html#ba6bb377466a0592aaedebe6a3518594">00511</a>                 <span class="keyword">public</span> function <a class="code" href="class_template.html#ba6bb377466a0592aaedebe6a3518594">accepts_gzip</a>()
<a name="l00512"></a>00512                 {
<a name="l00513"></a>00513                         <span class="keywordflow">if</span> (! isset($_SERVER[<span class="stringliteral">'HTTP_ACCEPT_ENCODING'</span>]))
<a name="l00514"></a>00514                                 {
<a name="l00515"></a>00515                                         <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00516"></a>00516                                 }
<a name="l00517"></a>00517                         $accept = str_replace(<span class="stringliteral">" "</span>, <span class="stringliteral">""</span>, strtolower($_SERVER[<span class="stringliteral">'HTTP_ACCEPT_ENCODING'</span>]));
<a name="l00518"></a>00518                         $accept = explode(<span class="stringliteral">","</span>, $accept);
<a name="l00519"></a>00519                         <span class="keywordflow">return</span> (in_array(<span class="stringliteral">"gzip"</span>, $accept) === <span class="keyword">true</span>);
<a name="l00520"></a>00520                 }
<a name="l00521"></a>00521                 
<a name="l00531"></a><a class="code" href="class_template.html#339c7c8616136872dc7aa1571339d418">00531</a>                 <span class="keyword">public</span> function <a class="code" href="class_template.html#339c7c8616136872dc7aa1571339d418">special_chars</a>(&amp;$content)
<a name="l00532"></a>00532                 {
<a name="l00533"></a>00533                         $trans = array(
<a name="l00534"></a>00534                                      chr(228) =&gt; <span class="stringliteral">"&amp;auml;"</span>,
<a name="l00535"></a>00535                                      chr(246) =&gt; <span class="stringliteral">"&amp;ouml;"</span>,
<a name="l00536"></a>00536                                      chr(252) =&gt; <span class="stringliteral">"&amp;uuml;"</span>,
<a name="l00537"></a>00537                                      chr(196) =&gt; <span class="stringliteral">"&amp;Auml;"</span>,
<a name="l00538"></a>00538                                      chr(214) =&gt; <span class="stringliteral">"&amp;Ouml;"</span>,
<a name="l00539"></a>00539                                      chr(220) =&gt; <span class="stringliteral">"&amp;Uuml;"</span>,
<a name="l00540"></a>00540                                      chr(171) =&gt; <span class="stringliteral">"&amp;laquo;"</span>,
<a name="l00541"></a>00541                                      chr(187) =&gt; <span class="stringliteral">"&amp;raquo;"</span>,
<a name="l00542"></a>00542                                      chr(223) =&gt; <span class="stringliteral">"&amp;szlig;"</span>
<a name="l00543"></a>00543                                  );
<a name="l00544"></a>00544                         $content = strtr($content, $trans);
<a name="l00545"></a>00545                 }
<a name="l00546"></a>00546                 
<a name="l00560"></a><a class="code" href="class_template.html#94df1a5e3d8270ecc99d74927f456372">00560</a>                 <span class="keyword">public</span> function <a class="code" href="class_template.html#94df1a5e3d8270ecc99d74927f456372">create_select</a>($array, $selected = <span class="stringliteral">""</span>)
<a name="l00561"></a>00561                 {
<a name="l00562"></a>00562                         $ret = <span class="stringliteral">""</span>;
<a name="l00563"></a>00563                         
<a name="l00564"></a>00564                         <span class="keywordflow">if</span> (! is_array($array)) $array = explode(<span class="stringliteral">"|"</span>, $array);
<a name="l00565"></a>00565                         
<a name="l00566"></a>00566                         <span class="keywordflow">if</span> (is_array($array) &amp;&amp; count($array) &gt; 1)
<a name="l00567"></a>00567                                 {
<a name="l00568"></a>00568                                         <span class="keywordflow">foreach</span>($array as $key =&gt; $value)
<a name="l00569"></a>00569                                         {
<a name="l00570"></a>00570                                                 <span class="keywordflow">if</span> ($selected != <span class="stringliteral">""</span> &amp;&amp; ($selected == $value || $selected == $key))
<a name="l00571"></a>00571                                                         {
<a name="l00572"></a>00572                                                                 $ret.=<span class="stringliteral">"&lt;option value=\"$key\" selected=\"selected\"&gt;$value&lt;/option&gt;"</span>;
<a name="l00573"></a>00573                                                         }
<a name="l00574"></a>00574                                                 <span class="keywordflow">else</span>
<a name="l00575"></a>00575                                                         {
<a name="l00576"></a>00576                                                                 $ret.=<span class="stringliteral">"&lt;option value=\"$key\"&gt;$value&lt;/option&gt;"</span>;
<a name="l00577"></a>00577                                                         }
<a name="l00578"></a>00578                                         }
<a name="l00579"></a>00579                                 }
<a name="l00580"></a>00580                         <span class="keywordflow">return</span> $ret;
<a name="l00581"></a>00581                 }
<a name="l00582"></a>00582                 
<a name="l00593"></a><a class="code" href="class_template.html#33f28ea990f28b657b61f54926452d79">00593</a>                 <span class="keyword">public</span> function <a class="code" href="class_template.html#33f28ea990f28b657b61f54926452d79">replace_data_from_array</a>(&amp;$data, &amp;$array)
<a name="l00594"></a>00594                 {
<a name="l00595"></a>00595                         <span class="keywordflow">foreach</span>($array as $key =&gt; $value)
<a name="l00596"></a>00596                         {
<a name="l00597"></a>00597                                 $data[<span class="stringliteral">"&lt;!--"</span>.strtoupper($key).<span class="stringliteral">"--&gt;"</span>] = $value;
<a name="l00598"></a>00598                         }
<a name="l00599"></a>00599                 }
<a name="l00600"></a>00600                 
<a name="l00613"></a><a class="code" href="class_template.html#8b6097874b0e2ad621bffe7a70ace60c">00613</a>                 <span class="keyword">public</span> function <a class="code" href="class_template.html#8b6097874b0e2ad621bffe7a70ace60c">align_right</a>($text, $maxlen = 16)
<a name="l00614"></a>00614                 {
<a name="l00615"></a>00615                         $len = strlen($text);
<a name="l00616"></a>00616                         <span class="keywordflow">if</span> ($len &gt; $maxlen) <span class="keywordflow">return</span> $text;
<a name="l00617"></a>00617                         <span class="keywordflow">return</span> str_repeat(<span class="stringliteral">" "</span>, $maxlen - $len).$text;
<a name="l00618"></a>00618                 }
<a name="l00619"></a>00619                 
<a name="l00627"></a><a class="code" href="class_template.html#2c26858a0833404049ac335d2dac3906">00627</a>                 <span class="keyword">public</span> function <a class="code" href="class_template.html#2c26858a0833404049ac335d2dac3906">menu_insert_spacer</a>()
<a name="l00628"></a>00628                 {
<a name="l00629"></a>00629                         $this-&gt;menu_spacer = <span class="keyword">true</span>;
<a name="l00630"></a>00630                 }
<a name="l00631"></a>00631                 
<a name="l00645"></a><a class="code" href="class_template.html#0802cb2769b3aee83cf3458918a8fdd0">00645</a>                 <span class="keyword">public</span> function <a class="code" href="class_template.html#0802cb2769b3aee83cf3458918a8fdd0">menu_insert_entry</a>($name, $href, $access_key = <span class="keyword">false</span>, $selected = <span class="keyword">false</span>, $target = <span class="stringliteral">"_self"</span>)
<a name="l00646"></a>00646                 {
<a name="l00647"></a>00647                         <span class="comment">// append session id, if no cookies in use</span>
<a name="l00648"></a>00648                         <span class="keywordflow">if</span> (ini_get(<span class="stringliteral">"session.use_cookies"</span>) != <span class="stringliteral">"1"</span>)
<a name="l00649"></a>00649                                 {
<a name="l00650"></a>00650                                         $sid = ini_get(<span class="stringliteral">"session.name"</span>).<span class="stringliteral">"="</span>.session_id();
<a name="l00651"></a>00651                                         $href .= (strpos($href,<span class="stringliteral">"?"</span>)===<span class="keyword">false</span>)?(<span class="stringliteral">"?"</span>.$sid):(<span class="stringliteral">"&amp;amp;"</span>.$sid);
<a name="l00652"></a>00652                                 }
<a name="l00653"></a>00653                         <span class="comment">// check for preset spacer for next entry</span>
<a name="l00654"></a>00654                         $return  = ($this-&gt;menu_spacer) ? <span class="stringliteral">'&lt;li class="spacer"&gt;'</span> : <span class="stringliteral">'&lt;li&gt;'</span>;
<a name="l00655"></a>00655                         $return .= <span class="stringliteral">'&lt;a '</span>.(is_string($access_key) ? <span class="stringliteral">'accesskey="'</span>.$access_key.<span class="stringliteral">'" '</span> : <span class="stringliteral">''</span>);
<a name="l00656"></a>00656                         $return .= ($selected ? <span class="stringliteral">'class="selected" '</span> : <span class="stringliteral">''</span>).<span class="stringliteral">'href="'</span>.$href.<span class="stringliteral">'" target="'</span>.$target.<span class="stringliteral">'"&gt;'</span>.$name.<span class="stringliteral">'&lt;/a&gt;&lt;/li&gt;'</span>;
<a name="l00657"></a>00657                         <span class="comment">// reset spacer</span>
<a name="l00658"></a>00658                         $this-&gt;menu_spacer   = <span class="keyword">false</span>;
<a name="l00659"></a>00659                         $this-&gt;menu_content .= $return;
<a name="l00660"></a>00660                 }
<a name="l00661"></a>00661                 
<a name="l00671"></a><a class="code" href="class_template.html#0d22097e1bf560ef7d4aba58c7b1e7fe">00671</a>                 <span class="keyword">public</span> function <a class="code" href="class_template.html#0d22097e1bf560ef7d4aba58c7b1e7fe">menu_get</a>()
<a name="l00672"></a>00672                 {
<a name="l00673"></a>00673                         $return = <span class="stringliteral">'&lt;ul id="main_menu"&gt;'</span>.$this-&gt;menu_content.<span class="stringliteral">'&lt;/ul&gt;'</span>;
<a name="l00674"></a>00674                         $this-&gt;menu_content = <span class="stringliteral">""</span>;
<a name="l00675"></a>00675                         <span class="keywordflow">return</span> $return;
<a name="l00676"></a>00676                 }
<a name="l00677"></a>00677                 
<a name="l00687"></a><a class="code" href="class_template.html#13f26a9fe366b92f0897785a3d01f9be">00687</a>                 <span class="keyword">public</span> function <a class="code" href="class_template.html#13f26a9fe366b92f0897785a3d01f9be">use_database</a>()
<a name="l00688"></a>00688                 {
<a name="l00689"></a>00689                         <span class="keywordflow">return</span> ($_SESSION[<span class="stringliteral">"_TplSqlTable"</span>] &amp;&amp; $_SESSION[<span class="stringliteral">"_SqlType"</span>]);
<a name="l00690"></a>00690                 }
<a name="l00691"></a>00691                 
<a name="l00692"></a>00692         }
<a name="l00693"></a>00693 
<a name="l00694"></a>00694 ?&gt;
</pre></div></div>
<hr size="1"><address style="text-align: right;"><small>Generated on Sat Jun 21 10:53:59 2008 for TimeRecording by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.5.6 </small></address>
</body>
</html>
